{% load static sekizai_tags geojson_tags %}
<div id="{{table.label|slugify}}-container" class='tab-pane fade'>
  <div class='table-responsive'>
    <table id="{{table.label|slugify}}-table" 
      class="table table-hover w-100"
      {% comment %} {% if user.is_owner %}
        data-ajax="{{table.url}}editor/?format=datatables&{{filter_by}}"          
      {% else %} {% endcomment %}
        data-ajax="/api/heat-production/?format=datatables&{{filter_by}}"
      {% comment %} {% endif %} {% endcomment %}
      >
      <thead><tr>
      {% if table.preheader %}
        {% for cell in table.preheader %}
          <th colspan={{cell.0}}><span {% if cell.2 %}data-placement="right" data-trigger="hover" data-html="true" data-content="{{cell.2|safe}}"{% endif %}>{{cell.1|safe}}</th>
        {% endfor %}
        </tr>
      {% endif %}
      <tr>
      {% for cell in table.header %}
        <th data-data='{{cell.0}}'><span {% if cell.2 %}data-placement="bottom" data-trigger="hover" data-html="true" data-content="{{cell.2|safe}}"{% endif %}>{{cell.1|safe}}</th>
      {% endfor %}
      </tr></thead>
    </table>
  </div>
</div>

{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.21/r-2.2.5/datatables.min.css"/>{% endaddtoblock %}
{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="{% static 'data_editor/css/editor.dataTables.css' %}"/>{% endaddtoblock %}


{% addtoblock "js" %}<script>$(function(){$('[data-trigger="hover"]').popover()})</script>{% endaddtoblock %}
{% comment %} {% addtoblock "js" %}<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.21/r-2.2.5/datatables.min.js"></script>{% endaddtoblock %} {% endcomment %}



{% addtoblock "js" %}<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static 'data_editor/js/dataTables.editor.js' %}"></script>{% endaddtoblock %}


{% comment %} {% addtoblock "js" %}<script src="{% static 'thermoglobe/js/table.js' %}"></script>{% endaddtoblock %} {% endcomment %}
{% comment %} {% addtoblock "js" %}<script>$('#{{table.label|slugify}}-table').create_table()</script>{% endaddtoblock %} {% endcomment %}

{% with table.label|slugify as id %}
{% addtoblock "js" %}
<script src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.0/js/dataTables.select.min.js"></script>

<script>

$(document).ready(function () {
  editor = new $.fn.dataTable.Editor({
      {% comment %} ajax: "/api/heat-production/editor/?format=datatables", {% endcomment %}
      table: '#{{id}}-table',
      idSrc:  'id',
      fields: [ {
                label: "Site name:",
                name: "site.site_name"
            }, {
                label: "Lat:",
                name: "site.latitude"
            }, {
                label: "Lon:",
                name: "site.longitude"
            }, {
                label: "Depth:",
                name: "depth"
            }, {
                label: "Heat production:",
                name: "heat_production"
            }, {
                label: "Uncertainty:",
                name: "uncertainty",
            }, {
                label: "Method:",
                name: "method"
            }
        ]
  });



  var table = $('#{{id}}-table').DataTable({
      "serverSide": true,
      dom: "Bfrtip",
      ajax: "{{table.url}}editor/?format=datatables&{{filter_by}}"   
      select: true,
      buttons: [
          {extend: "create", editor: editor},
          {extend: "edit", editor: editor},
          {extend: "remove", editor: editor}
      ]
  });



  table.buttons().container()
      .appendTo($('.col-md-6:eq(0)', table.table().container()));



    $('#{{id}}-table').on( 'click', 'tbody td:not(:first-child)', function (e) {
        editor.inline( this );
    } );

});



</script>{% endaddtoblock %}
{% endwith %}