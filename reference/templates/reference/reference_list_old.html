{% extends "main/list_view.html" %}
{% load widget_tweaks %}

{% block head %}<title>References | Heatflow.org</title>{% endblock head%}
{% block list_header %}
  <h1 align="center">References</h1>
  Heatflow.org currently contains {{ count }} individual references spanning {{ num_years }} years of heat flow measurements around the globe! Search here to find a particular reference and access the related data. If you can't find what you're looking for but know it exists, why not <a href={% url 'main:upload' %}>upload</a> the data and help keep the largest heat flow database in the world up to date! 
{% endblock list_header%}

{% block filter %}

  <div class="card card-spacing filter-card">
    <div class="card-body">
      <h5 class="card-title">Filter</h5>
      <form action="" method='GET'>
        <table>
          <tbody>
            <tr>
              <td>
                {% render_field filter.form.last_name class='form-control' placeholder='Last name' %}
              </td>
            </tr>
            <tr>
              <td>
                <div class='input-group'>
                  {% render_field filter.form.year_min class='form-control' placeholder='Year from' %}
                  &nbsp;
                  {% render_field filter.form.year_max class='form-control' placeholder='Year to' %}
                  &nbsp;
                  <button type='submit' class='btn btn-primary'>Update</button> 
                </div>
              </td>
            </tr>
          </tbody>
        </table>  
      </form>
    </div>
  </div>
{% endblock filter %}

{% block sort_by_links %}
  <p id='links'>
    Sort by: 
    <a href="">Year</a>
    <a href="">Last name</a>
  </p>
{% endblock sort_by_links %}



{% block list %}
  <div class='row'>
    {% for ref in filter.qs %}
      {% comment %} <a href='reference/{{ref.id}}/' class="linked-card">   {% endcomment %}
      <a href={% url 'reference:reference_details' reference_id=ref.id reference_slug=ref.reference|slugify %} class="linked-card">  
        <div class="card card-spacing listCards"> 
          <div class="card-header">
            <div class="container">
              <div class="row">
                <div class="col-sm">
                  {% if ref.title %}
                    <b>{{ ref.first_author.last_name }} {{ref.year}}</b> - {{ ref.title }}
                  {% else %}
                    <b>{{ ref.first_author.last_name}} {{ref.year|default_if_none:''}} </b>
                  {% endif %}
                </div>
                <div class="col-sm text-muted text-right">
                  <p class='small'>{{ref.date_added}}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="card-body">
            <table class="table table-borderless text-center equal-width">
              <tbody>
                <tr>
                  <td>Sites: {{ref.site_set.count}}</td>
                  <td>Heat flow: {{ref.depthinterval_set.count}}</td>
                  <td>Thermal conductivity: {{ref.conductivity_set.count}}</td>
                  <td>Heat Generation: {{ref.heatgeneration_set.count}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </a>
    {% empty %}
      <p>Could not find any references!</p>
    {% endfor %}
  </div>
{% endblock list%}

{% block scripts %}

  <script>


  {% comment %} $( document ).ready(function() {
      console.log( "ready!" );

      $(".form-control").change( function () {

        var lastName = $('#last_name').val();
        console.log(lastName)
        var minYear = $('#min_year').val();
        console.log(minYear)
        var maxYear = $('#max_year').val();
        console.log(maxYear)

        $.ajax({
          url: "{% url 'reference:filter_data' %}",
          data: {
            'last_name': lastName,
            'year_min': minYear,
            'year_max': maxYear,
          },
          dataType: 'json',
          success: function (data) {
            console.log(data)
          }

        })}).keyup( function () {
          // fire the above change event after every letter
          $(this).change();
        });

  }); {% endcomment %}
  

  </script>

{% endblock scripts %}
