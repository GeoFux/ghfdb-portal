{% extends "main/list_view.html" %}
{% load widget_tweaks %}
{% load static %}

{% block head %}
  <script type="text/javascript" src="{% static '/main/js/jquery.tablesorter.js' %}"></script>
{% endblock head %}

{% block title %}<title>References | Heatflow.org</title>{% endblock title%}
{% block list_header %}
  <h1 align="center">References</h1>
  Heatflow.org currently contains {{ count }} individual references spanning {{ num_years }} years of heat flow measurements around the globe! Search here to find a particular reference and access the related data. If you can't find what you're looking for but know it exists, why not <a href={% url 'main:upload' %}>upload</a> the data and help keep the largest heat flow database in the world up to date! 
{% endblock list_header%}

{% block filter %}

  <div class="card card-spacing filter-card">
    <div class="card-body">
      <h5 class="card-title">Filter</h5>
      <form action="" method='GET'>
        <table>
          <tbody>
            <tr>
              <td>
                {% render_field filter.form.last_name class='form-control' placeholder='Last name' %}
              </td>
            </tr>
            <tr>
              <td>
                <div class='input-group'>
                  {% render_field filter.form.year_min class='form-control' placeholder='Year from' %}
                  &nbsp;
                  {% render_field filter.form.year_max class='form-control' placeholder='Year to' %}
                  &nbsp;
                  <button type='submit' class='btn btn-primary'>Update</button> 
                </div>
              </td>
            </tr>
          </tbody>
        </table>  
      </form>
    </div>
  </div>
  <br>
{% endblock filter %}

{% block list %}
  <div class='table-responsive'>
    <table id='detailsTable' class="table table-hover table-striped text-center">
      <thead class="thead-dark">
        <tr>
          <th class='align-items-center'>Reference <i class="fas fa-sort fa-sm"></i></th>
          <th>Year</th> 
          <th>Sites</th>
          <th>Heat Flow</th>
          <th>Thermal Conductivity</th>
          <th>Heat Generation</th>
          <th>Date Added</th>
        </tr>
      </thead>   
      <tbody>
        {% for ref in result %}
          <tr>
            <td>
              <a href="{% url 'reference:reference_details' reference_id=ref.id reference_slug=ref.reference|slugify %}">{{ ref.first_author.last_name }}{{ ref.year|default_if_none:'' }}</a>
            </td>
            <td>{{ ref.year|default_if_none:'Unknown' }}</td>
            <td>{{ ref.site_set.count }}</td>
            <td>{{ ref.depthinterval_set.count }}</td>
            <td>{{ ref.conductivity_set.count }}</td>
            <td>{{ ref.heatgeneration_set.count }}</td>
            <td><p class='small'>{{ref.date_added}}</p></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock list%}

{% block more-scripts %}

  <script>
  $(document).ready(function(){
    $(function() {
      $("#detailsTable").tablesorter();
    });
  });
  </script>
{% endblock more-scripts %}