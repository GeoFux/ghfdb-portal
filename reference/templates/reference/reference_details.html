{% extends "mapping/map_at_top.html" %}
{% load static %}
{% load custom_tags %}


{% block title %}
  <title>{{ reference.first_author.last_name }}{{ reference.year }} | Heatflow.org</title>
{% endblock title %}

{% block extended_head %}

  <script src='https://cdn.rawgit.com/larsgw/citation.js/archive/citation.js/citation-VERSION.js'></script>

{% endblock extended_head %}

{% block content %}
  <div id='reference-container' class='container text-center'>
    <div>
      {% comment %} <script>console.log({{ form }})</script> {% endcomment %}

      <!-- START CARD -->
      <div id='reference-info-card' class='card'>
          <div class="card-header align-items-center" id="info-card-heading">
            <div class='container'>
              <div class='row align-items-center'>
                <div class='col'></div>
                <div class='col-lg'>
                  <a href="#heading-collapsible" data-toggle="collapse" aria-expanded="false">
                    <h3>
                      {{ reference.first_author.last_name }}
                      {% if reference.co_authors.count == 1 %}
                        {% for co_author in reference.co_authors.all %}
                          &amp; {{ co_author.last_name }}
                        {% endfor %}
                      {% endif %}
                      ({{ reference.year }})
                    </h3>
                  </a>       
                </div>
                <div class='col'>
                  <button  type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
                    <i class="fas fa-file-download fa-2x"></i>
                  </button>
                </div>
              </div>
            </div>        
          </div>
        <div id="heading-collapsible" class="collapse" aria-labelledby="info-card-heading" data-parent="#reference-info-card">
          <div class="card-body text-center">
            <div>
              <span>Title: {{ reference.title|default:'N/A' }}</span>
            </div>
            <div>
              DOI: 
              {% if reference.doi %}
                <a href="https://doi.org/{{ reference.doi }}">{{ reference.doi }}</a>
              {% else %}
                N/A
              {% endif %}    
            </div>
            <div>
              Total Sites: {{ reference.site_set.count }}
            </div>
          </div>
        </div>

      </div>
    </div>
    <!-- START TABLE -->
    <div class='table-responsive'>
      <table id='detailsTable' class="table table-hover table-striped">
        <thead class="thead-dark">
          <tr>
            <th class='align-items-center'>Site name <i class="fas fa-sort fa-sm"></i></th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Elevation [m]</th>
            <th>Heat Flow* [mW/m<sup>2</sup>]</th>
            <th>Thermal Conductivity* [W/mK]</th>
            <th>Heat Generation* [&micro;W/m<sup>3</sup>]</th>
            <th>Depth Intervals</th>
          </tr>
        </thead>   
        <tbody>
        {% for site in all_sites %}
          <tr>
            <td>
              {% if site.site_name %}
                <a href="{% url 'main:site' site.id site.site_name|slugify %}">
                  {{ site.site_name }}</a>
              {% else %}
                <a href="{% url 'main:site' site.id 'Unnamed Site'|slugify %}">
                  NA</a>
              {% endif %} </td>
            <td>{{ site.latitude }}</td>
            <td>{{ site.longitude }}</td>
            <td>{{ site.elevation|default_if_none:'' }}</td>
            <td>{{ site.avg_heatflow|default_if_none:'' }}</td>
            <td>{{ site.avg_conductivity|default_if_none:'' }}</td>
            <td>{{ site.avg_heatgen|default_if_none:'' }}</td>
            <td>{{ site.depthinterval_set.count|default_if_none:'' }}</td>

          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <p class='small text-right'>*average value for site over all depth intervals</p>   
  </div>
  {% include 'main/download_modal.html' %}



{% endblock content %}

{% block more-scripts %}

  <script>

    $(function() {
      $("#detailsTable").tablesorter();
    });
  
  </script>
{% endblock more-scripts %}





